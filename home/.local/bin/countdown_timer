#!/usr/bin/env bash

start_time=$(echo "" | tr -d '\n' | dmenu -p "祥")
notification_title="祥"

start_timer() {
	end_time=$(date -ud "$start_time minutes" +"%s")

	while [ "$(date -u +"%s")" -lt "$end_time" ]; do
		remaining_time=$((end_time - $(date -u +"%s")))

		minutes=$((remaining_time / 60))
		seconds=$((remaining_time % 60))

		notify-send "$notification_title" "$(printf "%02d:%02d" $minutes $seconds)"
		sleep 60
	done
}

if [[ -z "${start_time// /}" ]]; then
	exit
else
	start_timer
	notify-send "$notification_title" "Nedräkningen är över!"
	mpg123 "$HOME/.local/bin/beep-beep.mp3"
fi
