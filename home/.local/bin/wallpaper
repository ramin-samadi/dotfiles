#!/usr/bin/env bash

SELECTED_WALLPAPER=$(sxiv -tfo .wallpaper)

if [[ -z "${SELECTED_WALLPAPER// /}" ]]; then
	exit
fi

xwallpaper --zoom "$HOME/$SELECTED_WALLPAPER"
echo "/home/$USER/$SELECTED_WALLPAPER" >/home/$USER/xwallpaper
BACKGROUND_COLOR=$(convert /home/$USER/$SELECTED_WALLPAPER -resize 1x1 -colors 1 -format "%c" histogram:info:- | sort -rn | uniq -c | awk 'NR==1{gsub(/.*#/, ""); printf("#%s;\n", $1)}' | cut -c 1-7)

BACKGROUND_BRIGHTNESS=$(convert "xc:$BACKGROUND_COLOR" -colorspace hsl -channel L -separate +channel -format "%[fx:int(100*u.p{0})]\n" info:)

# Determine the appropriate text color based on the background brightness
if (("$BACKGROUND_BRIGHTNESS" < 50)); then
	TEXT_COLOR="#CDD6F4"
else
	TEXT_COLOR="#313244"
fi

# extract red, green, and blue values from hex color code
r=$(echo $BACKGROUND_COLOR | cut -c 2-3)
g=$(echo $BACKGROUND_COLOR | cut -c 4-5)
b=$(echo $BACKGROUND_COLOR | cut -c 6-7)

# convert hex values to decimal values
r=$(printf "%d" 0x$r)
g=$(printf "%d" 0x$g)
b=$(printf "%d" 0x$b)
notify-send "$BACKGROUND_COLOR" "$r $g $b"
echo "$BACKGROUND_COLOR" | xclip -selection clipboard

if [ $r -ge 120 ] && [ $g -ge 0 ] && [ $g -lt 100 ] && [ $b -ge 0 ]; then
	echo "\$material-you: #f38ba8; \$text-color: #313244; \$slider: #f38ba8; \$shortcut: #f38ba8; \$hover: #e2718e;" >/home/ramin/.config/eww/actions/colors.scss
elif [ $r -ge 0 ] && [ $r -lt 200 ] && [ $g -gt 100 ] && [ $b -ge 0 ] && [ $b -lt 160 ]; then
	echo "\$material-you: #a6e3a1; \$text-color: #313244; \$slider: #a6e3a1; \$shortcut: #a6e3a1; \$hover: #86c17a;" >/home/ramin/.config/eww/actions/colors.scss
elif [ $r -ge 0 ] && [ $r -lt 100 ] && [ $g -ge 0 ] && [ $g != 13] && [ $b -gt 120 ]; then
	echo "\$material-you: #89b4fa; \$text-color: #313244; \$slider: #89b4fa; \$shortcut: #89b4fa; \$hover: #6c8fc5;" >/home/ramin/.config/eww/actions/colors.scss
elif [ $r -ge 0 ] && [ $r -lt 140 ] && [ $g -ge 0 ] && [ $g != 13 ] && [ $b -gt 120 ]; then
	echo "\$material-you: #89b4fa; \$text-color: #313244; \$slider: #89b4fa; \$shortcut: #89b4fa; \$hover: #6c8fc5;" >/home/ramin/.config/eww/actions/colors.scss
elif [ $r -ge 0 ] && [ $r -lt 60 ] && [ $g -ge 0 ] && [ $g != 13 ] && [ $g -lt 100 ] && [ $b -gt 60 ]; then
	echo "\$material-you: #89b4fa; \$text-color: #313244; \$slider: #89b4fa; \$shortcut: #89b4fa; \$hover: #6c8fc5;" >/home/ramin/.config/eww/actions/colors.scss
elif [ $r -ge 100 ] && [ $r -lt 150 ] && [ $g -ge 170 ] && [ $g -lt 200 ] && [ $b -gt 150 ]; then
	echo "\$material-you: #89b4fa; \$text-color: #313244; \$slider: #89b4fa; \$shortcut: #89b4fa; \$hover: #6c8fc5;" >/home/ramin/.config/eww/actions/colors.scss
elif [ $r -gt 200 ] && [ $g -gt 195 ] && [ $b -lt 130 ]; then
	echo "\$material-you: #f9e2af; \$text-color: $TEXT_COLOR; \$slider: #f9e2af; \$shortcut: #f9e2af; \$hover: #e6cb86;" >/home/ramin/.config/eww/actions/colors.scss
elif [ $r -gt 50 ] && [ $g -lt 100 ] && [ $b -gt 100 ]; then
	echo "\$material-you: #cba6f7; \$text-color: #313244; \$slider: #cba6f7; \$shortcut: #cba6f7; \$hover: #a082d8;" >/home/ramin/.config/eww/actions/colors.scss
elif [ $r -gt 50 ] && [ $g -lt 100 ] && [ $b -gt 80 ]; then
	echo "\$material-you: #cba6f7; \$text-color: #313244; \$slider: #cba6f7; \$shortcut: #cba6f7; \$hover: #a082d8;" >/home/ramin/.config/eww/actions/colors.scss
elif [ $r -gt 200 ] && [ $g -lt 165 ] && [ $b -gt 150 ]; then
	echo "\$material-you: #f5c2e7; \$text-color: $TEXT_COLOR; \$slider: #f5c2e7; \$shortcut: #f5c2e7; \$hover: #dd9fc7;" >/home/ramin/.config/eww/actions/colors.scss
elif [ $r -gt 200 ] && [ $g -lt 210 ] && [ $b -gt 200 ]; then
	echo "\$material-you: #f5c2e7; \$text-color: $TEXT_COLOR; \$slider: #f5c2e7; \$shortcut: #f5c2e7; \$hover: #dd9fc7;" >/home/ramin/.config/eww/actions/colors.scss
elif [ $r -gt 200 ] && [ $g -gt 100 ] && [ $g -lt 200 ] && [ $b -lt 100 ]; then
	echo "\$material-you: #fab387; \$text-color: $TEXT_COLOR; \$slider: #fab387; \$shortcut: #fab387; \$hover: #e78b60;" >/home/ramin/.config/eww/actions/colors.scss
elif [ $r -lt 50 ] && [ $g -lt 50 ] && [ $b -lt 50 ]; then
	echo "\$material-you: #313244; \$text-color: $TEXT_COLOR; \$slider: #CDD6F4; \$shortcut: #45475A; \$hover: #3b3e52;" >/home/ramin/.config/eww/actions/colors.scss
else
	echo "\$material-you: $BACKGROUND_COLOR; \$text-color: $TEXT_COLOR; \$slider: $BACKGROUND_COLOR; \$shortcut: $BACKGROUND_COLOR; \$hover: $BACKGROUND_COLOR;" >/home/ramin/.config/eww/actions/colors.scss
fi
